---
# tasks file for dns
- name: Install dnsmasq
  yum:
    name: dnsmasq
    state: latest
- name: Enable service dnsmasq, and not touch the running state
  service:
    name: dnsmasq
    enabled: yes
- name: start service dnsmasq
  service:
    name: dnsmasq
    state: started

- name: making a static ip
  shell: echo -e "IPADDR=\"{{ipadresstoset}}\"\nNETMASK=\"255.255.255.0\"\nGATEWAY=\"192.168.122.1\"" >> /etc/sysconfig/network-scripts/ifcfg-eth0

- name: making entry in etc-hosts
  shell: echo -e "{{ hostvars[item]['ipadresstoset'] }} {{ hostvars[item]['inventory_hostname'] }} {{ hostvars[item]['shortname'] }}" >> /etc/hosts
  with_items:
     - "{{ groups['master'] }}"
     - "{{ groups['installer'] }}"
     - "{{ groups['node'] }}"

- name: making IPTABLE entry-tcp
  shell: iptables -I INPUT -s 192.168.122.0/24 -p tcp --dport 53 -j ACCEPT
- name: making IPTABLE entry-udp
  shell: iptables -I INPUT -s 192.168.122.0/24 -p udp --dport 53 -j ACCEPT

- name: Creating effective iptables_rules
  shell: iptables-save > /etc/iptables_rules
- name: script for iptables_rules
  shell: echo "/sbin/iptables-restore < /etc/iptables_rules" >> /etc/rc.local
- name: script for iptables_rules
  shell: chmod +x /etc/rc.d/rc.local
